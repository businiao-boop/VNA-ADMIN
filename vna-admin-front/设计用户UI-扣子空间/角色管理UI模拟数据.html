<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>角色管理系统</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .sidebar {
            transition: all 0.3s ease;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .selected-row {
            background-color: #f1f5f9 !important;
        }
        .menu-item {
            transition: all 0.2s ease;
        }
        .menu-item:hover {
            background-color: #f1f5f9;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen flex flex-col">
        <!-- 顶部导航 -->
        <header class="bg-white shadow-sm py-4 px-6 flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-user-shield text-indigo-600 text-xl mr-3"></i>
                <h1 class="text-xl font-semibold text-gray-800">角色管理系统</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-bell"></i>
                </button>
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            <!-- 左侧角色列表 -->
            <div class="sidebar w-1/3 bg-white border-r border-gray-200 overflow-y-auto">
                <div class="p-4">
                    <div class="flex mb-4">
                        <div class="relative flex-1 mr-3">
                            <input type="text" 
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
                                   placeholder="搜索角色名称"
                                   v-model="searchQuery"
                                   @input="handleSearch">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <button @click="showAddModal" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>新增
                        </button>
                    </div>

                    <div class="overflow-hidden rounded-lg border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">角色名称</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">创建时间</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="role in filteredRoles" 
                                    :key="role.id" 
                                    @click="selectRole(role)"
                                    :class="{'selected-row': selectedRole && selectedRole.id === role.id}"
                                    class="cursor-pointer hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="font-medium text-gray-900">{{ role.name }}</div>
                                        <div class="text-sm text-gray-500">{{ role.description }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ role.createTime }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button @click.stop="showEditModal(role)" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button @click.stop="showDeleteConfirm(role)" class="text-red-600 hover:text-red-900">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 右侧表单 -->
            <div class="flex-1 overflow-y-auto bg-white p-6">
                <div v-if="selectedRole" class="max-w-3xl mx-auto">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">{{ selectedRole.name }} - 权限配置</h2>
                        <p class="text-gray-600">{{ selectedRole.description }}</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-sm p-6 mb-6 card-hover">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-list-ul text-indigo-500 mr-2"></i>菜单权限
                        </h3>
                        <div class="space-y-2">
                            <div v-for="menu in menuTree" :key="menu.key" class="border border-gray-200 rounded-lg overflow-hidden">
                                <div @click="toggleMenu(menu)" 
                                     class="menu-item bg-gray-50 px-4 py-3 flex items-center justify-between cursor-pointer">
                                    <div class="flex items-center">
                                        <i :class="['fas', menu.expanded ? 'fa-folder-open' : 'fa-folder', 'text-indigo-500 mr-2']"></i>
                                        <span class="font-medium">{{ menu.title }}</span>
                                    </div>
                                    <i :class="['fas', menu.expanded ? 'fa-chevron-up' : 'fa-chevron-down', 'text-gray-400']"></i>
                                </div>
                                <div v-if="menu.expanded" class="px-4 py-2">
                                    <div v-for="subMenu in menu.children" :key="subMenu.key" class="ml-4 mb-2">
                                        <div @click="toggleSubMenu(subMenu)" 
                                             class="menu-item bg-white px-3 py-2 flex items-center justify-between cursor-pointer border border-gray-100 rounded">
                                            <div class="flex items-center">
                                                <i :class="['fas', subMenu.expanded ? 'fa-folder-open' : 'fa-folder', 'text-blue-400 mr-2']"></i>
                                                <span>{{ subMenu.title }}</span>
                                            </div>
                                            <i :class="['fas', subMenu.expanded ? 'fa-chevron-up' : 'fa-chevron-down', 'text-gray-400']"></i>
                                        </div>
                                        <div v-if="subMenu.expanded" class="ml-8 mt-2">
                                            <div v-for="item in subMenu.children" :key="item.key" class="mb-2">
                                                <div class="flex items-center justify-between px-3 py-2 bg-gray-50 rounded">
                                                    <div class="flex items-center">
                                                        <i class="fas fa-file-alt text-green-400 mr-2"></i>
                                                        <span>{{ item.title }}</span>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        <label v-for="perm in permissions" :key="perm.value" class="inline-flex items-center">
                                                            <input type="checkbox" 
                                                                   class="rounded text-indigo-600 focus:ring-indigo-500" 
                                                                   :checked="hasPermission(selectedRole, item.key, perm.value)"
                                                                   @change="togglePermission(selectedRole, item.key, perm.value)">
                                                            <span class="ml-2 text-sm">{{ perm.label }}</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button @click="saveRolePermissions" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                            <i class="fas fa-save mr-2"></i>保存
                        </button>
                        <button @click="resetForm" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-undo mr-2"></i>重置
                        </button>
                    </div>
                </div>
                <div v-else class="flex flex-col items-center justify-center h-full text-center py-20">
                    <i class="fas fa-user-shield text-5xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-medium text-gray-500 mb-2">请选择一个角色</h3>
                    <p class="text-gray-400">从左侧列表中选择一个角色进行权限配置</p>
                </div>
            </div>
        </div>

        <!-- 新增/编辑模态框 -->
        <div v-if="modalVisible" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">{{ modalTitle }}</h3>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">角色名称</label>
                        <input v-model="modalForm.name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">角色描述</label>
                        <textarea v-model="modalForm.description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button @click="handleModalCancel" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        取消
                    </button>
                    <button @click="handleModalOk" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                        {{ modalLoading ? '处理中...' : '确认' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- 删除确认对话框 -->
        <div v-if="deleteConfirmVisible" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">确认删除</h3>
                </div>
                <div class="p-6">
                    <p class="text-gray-600">确定要删除角色 <span class="font-semibold">{{ deleteRole ? deleteRole.name : '' }}</span> 吗？此操作不可撤销。</p>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button @click="deleteConfirmVisible = false" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                        取消
                    </button>
                    <button @click="confirmDelete" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
                        确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white py-4 border-t border-gray-200 text-center text-sm text-gray-500">
        <p>created by <a href="https://space.coze.cn" class="text-indigo-600 hover:text-indigo-800">coze space</a></p>
        <p class="mt-1">页面内容均由 AI 生成，仅供参考</p>
    </footer>

    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    searchQuery: '',
                    selectedRole: null,
                    modalVisible: false,
                    modalTitle: '新增角色',
                    modalLoading: false,
                    modalAction: 'add',
                    modalForm: {
                        id: '',
                        name: '',
                        description: ''
                    },
                    deleteConfirmVisible: false,
                    deleteRole: null,
                    
                    // 角色列表数据
                    roleList: [
                        { 
                            id: '1', 
                            name: '超级管理员', 
                            description: '系统最高权限角色，可访问所有功能', 
                            createTime: '2025-05-01',
                            permissions: {}
                        },
                        { 
                            id: '2', 
                            name: '系统管理员', 
                            description: '管理系统配置和用户权限', 
                            createTime: '2025-05-05',
                            permissions: {}
                        },
                        { 
                            id: '3', 
                            name: '运营专员', 
                            description: '负责内容管理和运营活动', 
                            createTime: '2025-05-10',
                            permissions: {}
                        },
                        { 
                            id: '4', 
                            name: '财务审核', 
                            description: '负责财务相关审核工作', 
                            createTime: '2025-05-15',
                            permissions: {}
                        },
                        { 
                            id: '5', 
                            name: '内容编辑', 
                            description: '负责内容创建和编辑', 
                            createTime: '2025-05-20',
                            permissions: {}
                        },
                        { 
                            id: '6', 
                            name: '数据分析师', 
                            description: '查看和分析系统数据', 
                            createTime: '2025-06-01',
                            permissions: {}
                        },
                        { 
                            id: '7', 
                            name: '客服代表', 
                            description: '处理用户咨询和问题', 
                            createTime: '2025-06-15',
                            permissions: {}
                        },
                        { 
                            id: '8', 
                            name: '访客', 
                            description: '仅限查看部分公开内容', 
                            createTime: '2025-07-20',
                            permissions: {}
                        }
                    ],
                    
                    // 菜单树数据
                    menuTree: [
                        {
                            key: 'system',
                            title: '系统管理',
                            expanded: true,
                            children: [
                                {
                                    key: 'basic',
                                    title: '基础设置',
                                    expanded: true,
                                    children: [
                                        { key: 'website', title: '网站配置' },
                                        { key: 'email', title: '邮件模板' }
                                    ]
                                },
                                {
                                    key: 'log',
                                    title: '日志管理',
                                    expanded: false,
                                    children: [
                                        { key: 'login-log', title: '登录日志' },
                                        { key: 'operation-log', title: '操作日志' }
                                    ]
                                },
                                {
                                    key: 'security',
                                    title: '安全配置',
                                    expanded: false,
                                    children: [
                                        { key: 'password-policy', title: '密码策略' },
                                        { key: 'ip-restriction', title: 'IP限制' }
                                    ]
                                }
                            ]
                        },
                        {
                            key: 'user',
                            title: '用户管理',
                            expanded: false,
                            children: [
                                {
                                    key: 'user-list',
                                    title: '用户列表',
                                    expanded: false,
                                    children: [
                                        { key: 'all-users', title: '所有用户' },
                                        { key: 'active-users', title: '活跃用户' }
                                    ]
                                },
                                {
                                    key: 'department',
                                    title: '部门管理',
                                    expanded: false,
                                    children: [
                                        { key: 'org-structure', title: '组织结构' },
                                        { key: 'position', title: '职位管理' }
                                    ]
                                }
                            ]
                        },
                        {
                            key: 'content',
                            title: '内容管理',
                            expanded: false,
                            children: [
                                {
                                    key: 'article',
                                    title: '文章管理',
                                    expanded: false,
                                    children: [
                                        { key: 'news', title: '新闻资讯' },
                                        { key: 'knowledge', title: '知识库' }
                                    ]
                                },
                                {
                                    key: 'category',
                                    title: '分类管理',
                                    expanded: false,
                                    children: [
                                        { key: 'content-category', title: '内容分类' },
                                        { key: 'tag', title: '标签管理' }
                                    ]
                                }
                            ]
                        },
                        {
                            key: 'finance',
                            title: '财务管理',
                            expanded: false,
                            children: [
                                {
                                    key: 'invoice',
                                    title: '发票管理',
                                    expanded: false,
                                    children: [
                                        { key: 'invoice-list', title: '发票列表' },
                                        { key: 'invoice-approval', title: '发票审批' }
                                    ]
                                },
                                {
                                    key: 'report',
                                    title: '财务报表',
                                    expanded: false,
                                    children: [
                                        { key: 'income', title: '收入报表' },
                                        { key: 'expense', title: '支出报表' }
                                    ]
                                }
                            ]
                        },
                        {
                            key: 'data',
                            title: '数据分析',
                            expanded: false,
                            children: [
                                {
                                    key: 'dashboard',
                                    title: '数据看板',
                                    expanded: false,
                                    children: [
                                        { key: 'user-analytics', title: '用户分析' },
                                        { key: 'content-analytics', title: '内容分析' }
                                    ]
                                },
                                {
                                    key: 'report',
                                    title: '数据报表',
                                    expanded: false,
                                    children: [
                                        { key: 'daily-report', title: '日报' },
                                        { key: 'monthly-report', title: '月报' }
                                    ]
                                }
                            ]
                        }
                    ],
                    
                    // 权限项数据
                    permissions: [
                        { value: 'view', label: '查看' },
                        { value: 'add', label: '新增' },
                        { value: 'edit', label: '编辑' },
                        { value: 'delete', label: '删除' },
                        { value: 'import', label: '导入' },
                        { value: 'export', label: '导出' }
                    ]
                };
            },
            created() {
                // 初始化角色权限
                this.initRolePermissions();
                // 默认选中第一个角色
                if (this.roleList.length > 0) {
                    this.selectRole(this.roleList[0]);
                }
            },
            computed: {
                filteredRoles() {
                    if (!this.searchQuery) {
                        return this.roleList;
                    }
                    const query = this.searchQuery.toLowerCase();
                    return this.roleList.filter(role => 
                        role.name.toLowerCase().includes(query) || 
                        role.description.toLowerCase().includes(query)
                    );
                }
            },
            methods: {
                // 初始化角色权限
                initRolePermissions() {
                    // 超级管理员 - 所有权限
                    this.roleList[0].permissions = this.getAllPermissions();
                    
                    // 系统管理员 - 系统管理和用户管理所有权限
                    this.roleList[1].permissions = {
                        ...this.getMenuPermissions(['system', 'user'], true)
                    };
                    
                    // 运营专员 - 内容管理所有权限，其他仅查看
                    this.roleList[2].permissions = {
                        ...this.getMenuPermissions(['content'], true),
                        ...this.getMenuPermissions(['system', 'user', 'finance', 'data'], false, ['view'])
                    };
                    
                    // 财务审核 - 仅财务相关权限
                    this.roleList[3].permissions = {
                        ...this.getMenuPermissions(['finance'], true)
                    };
                    
                    // 内容编辑 - 内容管理部分权限
                    this.roleList[4].permissions = {
                        ...this.getMenuPermissions(['content'], false, ['view', 'add', 'edit'])
                    };
                    
                    // 数据分析师 - 仅数据分析查看权限
                    this.roleList[5].permissions = {
                        ...this.getMenuPermissions(['data'], false, ['view'])
                    };
                    
                    // 客服代表 - 用户管理部分权限
                    this.roleList[6].permissions = {
                        ...this.getMenuPermissions(['user'], false, ['view', 'edit'])
                    };
                    
                    // 访客 - 仅部分查看权限
                    this.roleList[7].permissions = {
                        ...this.getMenuPermissions(['content'], false, ['view']),
                        ...this.getMenuPermissions(['data'], false, ['view'])
                    };
                },
                
                // 获取所有权限
                getAllPermissions() {
                    const allPermissions = {};
                    const traverse = (menu) => {
                        if (menu.children) {
                            menu.children.forEach(traverse);
                        } else {
                            allPermissions[menu.key] = this.permissions.map(p => p.value);
                        }
                    };
                    this.menuTree.forEach(traverse);
                    return allPermissions;
                },
                
                // 获取指定菜单的权限
                getMenuPermissions(menuKeys, allPermissions = true, specificPermissions = []) {
                    const permissions = {};
                    const traverse = (menu) => {
                        if (menu.children) {
                            menu.children.forEach(traverse);
                        } else {
                            if (menuKeys.includes(menu.key.split('-')[0])) {
                                permissions[menu.key] = allPermissions 
                                    ? this.permissions.map(p => p.value) 
                                    : specificPermissions;
                            }
                        }
                    };
                    this.menuTree.forEach(traverse);
                    return permissions;
                },
                
                // 选择角色
                selectRole(role) {
                    this.selectedRole = JSON.parse(JSON.stringify(role));
                },
                
                // 检查权限
                hasPermission(role, menuKey, permission) {
                    if (!role || !role.permissions) return false;
                    return role.permissions[menuKey] && role.permissions[menuKey].includes(permission);
                },
                
                // 切换权限
                togglePermission(role, menuKey, permission) {
                    if (!role.permissions[menuKey]) {
                        this.$set(role.permissions, menuKey, []);
                    }
                    
                    const index = role.permissions[menuKey].indexOf(permission);
                    if (index === -1) {
                        role.permissions[menuKey].push(permission);
                    } else {
                        role.permissions[menuKey].splice(index, 1);
                    }
                },
                
                // 保存角色权限
                saveRolePermissions() {
                    if (!this.selectedRole) return;
                    
                    const index = this.roleList.findIndex(r => r.id === this.selectedRole.id);
                    if (index !== -1) {
                        this.roleList[index].permissions = JSON.parse(JSON.stringify(this.selectedRole.permissions));
                        alert('权限保存成功');
                    }
                },
                
                // 重置表单
                resetForm() {
                    if (this.selectedRole) {
                        const originalRole = this.roleList.find(r => r.id === this.selectedRole.id);
                        if (originalRole) {
                            this.selectedRole.permissions = JSON.parse(JSON.stringify(originalRole.permissions));
                        }
                    }
                },
                
                // 搜索处理
                handleSearch() {
                    // 搜索逻辑已在计算属性filteredRoles中实现
                },
                
                // 显示新增模态框
                showAddModal() {
                    this.modalTitle = '新增角色';
                    this.modalAction = 'add';
                    this.modalForm = {
                        id: '',
                        name: '',
                        description: ''
                    };
                    this.modalVisible = true;
                },
                
                // 显示编辑模态框
                showEditModal(role) {
                    this.modalTitle = '编辑角色';
                    this.modalAction = 'edit';
                    this.modalForm = {
                        id: role.id,
                        name: role.name,
                        description: role.description
                    };
                    this.modalVisible = true;
                },
                
                // 显示删除确认
                showDeleteConfirm(role) {
                    this.deleteRole = role;
                    this.deleteConfirmVisible = true;
                },
                
                // 确认删除
                confirmDelete() {
                    if (this.deleteRole) {
                        const index = this.roleList.findIndex(r => r.id === this.deleteRole.id);
                        if (index !== -1) {
                            this.roleList.splice(index, 1);
                            if (this.selectedRole && this.selectedRole.id === this.deleteRole.id) {
                                this.selectedRole = null;
                            }
                        }
                        this.deleteConfirmVisible = false;
                        this.deleteRole = null;
                    }
                },
                
                // 模态框确认
                handleModalOk() {
                    if (!this.modalForm.name) {
                        alert('请输入角色名称');
                        return;
                    }
                    
                    this.modalLoading = true;
                    
                    setTimeout(() => {
                        if (this.modalAction === 'add') {
                            // 新增角色
                            const newRole = {
                                id: Date.now().toString(),
                                name: this.modalForm.name,
                                description: this.modalForm.description,
                                createTime: new Date().toISOString().split('T')[0],
                                permissions: {}
                            };
                            this.roleList.push(newRole);
                        } else {
                            // 编辑角色
                            const index = this.roleList.findIndex(r => r.id === this.modalForm.id);
                            if (index !== -1) {
                                this.roleList[index].name = this.modalForm.name;
                                this.roleList[index].description = this.modalForm.description;
                                
                                if (this.selectedRole && this.selectedRole.id === this.modalForm.id) {
                                    this.selectedRole.name = this.modalForm.name;
                                    this.selectedRole.description = this.modalForm.description;
                                }
                            }
                        }
                        
                        this.modalLoading = false;
                        this.modalVisible = false;
                    }, 500);
                },
                
                // 模态框取消
                handleModalCancel() {
                    this.modalVisible = false;
                },
                
                // 切换菜单展开状态
                toggleMenu(menu) {
                    menu.expanded = !menu.expanded;
                },
                
                // 切换子菜单展开状态
                toggleSubMenu(subMenu) {
                    subMenu.expanded = !subMenu.expanded;
                }
            }
        });
    </script>
</body>
</html>